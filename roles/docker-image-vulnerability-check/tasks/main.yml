---
# tasks file for package-security-check

- name: Inspect a single image
  shell: curl 'https://registry.hub.docker.com/v2/repositories/library/httpd/tags/'|jq '."results"[]["name"]'
  register: docker_facts_results

- name: List of docker facts
  debug:
    msg: "{{ docker_facts_results.stdout_lines }}" #"| map(attribute='stdout_lines') | list }}"

- name: Create a file with today's docker hub version list
  copy:
    content: "{{ docker_facts_results.stdout_lines }}"
    dest: templates/today_docker_versions.txt

#####
- name: Compare todays and yestrdays versions
  copy:
    src: templates/today_docker_versions.txt
    dest: templates/yesterdays_docker_versions.txt
  check_mode: yes
  diff: yes
  register: difference
####

- name: Show diferences
  debug:
    msg: "{{ difference.diff | map(attribute='after') | list }}"

- name: Copy today's versions to yesterday's state
  template:
    src: templates/today_docker_versions.txt
    dest: templates/yesterday_docker_versions.txt
